name: "Scan and Upload SARIF"
description: "Scan code using SFDX scanner and upload SARIF file"
outputs:
  scan-exit-code:
    description: "PMD Scan exit code"
    value: ${{ steps.pmd-scan.outputs.scan-exit-code }}
runs:
  using: "composite"
  steps:
    - name: "Scan and Upload SARIF"
      shell: bash
      id: pmd-scan
      run: |
        cd changed-sources
        if ! sf scanner:run --format sarif --target './**/*.cls' --outfile 'apexScanResults.sarif' --severity-threshold 1; then
          scan_exit_code=1
        else
          scan_exit_code=0
        fi
        echo "scan-exit-code=$scan_exit_code" >> $GITHUB_OUTPUT
        cd ..
